---
title: "SQL 쿼리문 수행 순서"
date: 2026-02-12 00:00:00 +0900
categories: [Tech, SQL]
tags: [SQL]
---

## 방금 만든 컬럼의 별칭(Alias), 왜 사용이 안될까?

![SQL 수행 순서](/assets/img/sql_7-1.PNG)

쿼리를 짤 때 SELECT 절에서 연산 결과에 별칭(Alias)을 붙이곤 한다.  
하지만 그 별칭을 위쪽의 사진처럼 WHERE 절이나 HAVING 절에서 바로 쓰려고 하면 어김없이 에러를 마주하게 된다.  
<br>

SELECT sal*12 AS ANN_SAL로 정의한 별칭 ANN_SAL을 WHERE ANN_SAL > 10000 처럼 사용하려고 했더니 에러가 났다.  
SQL 엔진은 우리가 글을 읽는 순서(SELECT → FROM → WHERE)대로 작동하지 않기 때문이다.  
<br>

![SQL 수행 순서](/assets/img/sql_7-2.PNG)

SELECT 절에서 선언한 새로움 컬럼의 별칭인 ANN_SAL이 수행되기 전에 WHERE 절이 먼저 수행된다.  
때문에 이렇게 위에 사진처럼 sal*12처럼 수식 자체를 WHERE절에서 사용해야 비로소 원하는 결과가 조회된다.  

<hr style="height: 5px; background-color: #777; border: none;">

## SQL 엔진의 진짜 실행 순서
컴퓨터가 쿼리를 처리하는 논리적 순서를 알면 모든 의문이 풀린다.  
다음의 쿼리문 수행 순서를 알아두자.  
<br>

><쿼리문 수행 순서>  
>1) FROM: 데이터를 어디서 가져올지 집합을 먼저 정합니다.  
>2) WHERE: 가져온 데이터 중 조건에 맞는 행만 거릅니다.  
>3) GROUP BY / HAVING: 데이터를 그룹화하고 그룹별 조건을 체크합니다.  
>4) SELECT: 비로소 화면에 출력할 컬럼을 고르고 별칭을 부여합니다.  
>5) ORDER BY: 최종 확정된 결과를 정렬합니다.
<br>

![SQL 수행 순서](/assets/img/sql_7-3.PNG)

WHERE와 HAVING은 SELECT보다 먼저 수행된다. 따라서 SELECT에서 정의한 별칭을 이들이 알 방법이 없다.  
반면, 위 사진처럼 ORDER BY는 가장 마지막에 수행되므로 SELECT에서 만든 별칭을 자유롭게 사용할 수 있다.  
<br>

![SQL 수행 순서](/assets/img/sql_7-4.PNG)

위쪽에 보면, HAVING절이 먼저 수행되고 SELECT절이 수행되기 때문에  
SELECT절에서 선언한 새로운 컬럼의 별칭을 사용하면 오류가 발생하게 된다.
<br>
<br>

![SQL 수행 순서](/assets/img/sql_7-5.PNG)

이렇게 HAVING절에서 그냥 수식 자체를 사용하면 비로소 오류없이 수행된다.
<br>

>즉, 조건에 맞게 먼저 데이터를 거른 후에 원하는 컬럼을 SELECT 조회하게 된다.
<br>

만약 앞에서 순서대로 수행되어 SELECT 절이 먼저 수행되면  
굳이 필요없는 데이터까지 한번 쭉 훑어본 후에 다시 조건절의 내용으로 필터링되면서 효율성이 떨어지게 된다.  

<hr style="height: 5px; background-color: #777; border: none;">

## 한 걸음 더: 문법보다 원리가 먼저다.
쿼리문 수행 순서가 굉장히 논리적이고 효율적이여서 흥미롭고 한층 더 재미있어졌다.  
확실히 나는 왜 이런 논리가 필요하고 그래서 이런 논리 흐름으로 실제로 수행되는지 알게되는 것에 흥미를 많이 느낀다.  
이러한 수행 순서를 이해하고 나니, 데이터가 필터링되는 시점이 언제인지 명확히 보였다.  
특히 HAVING 절에서 그룹 함수 별칭이 안 먹혀 당황했던 경험은, 쿼리의 논리적 흐름을 다시 공부하게 된 좋은 계기가 되었다.  
<br>

쿼리 수행 순서를 모른 채 중복 수식을 남발하면 코드 가독성이 떨어지고,  
결국 대규모 연산이 포함된 경우 불필요한 자원 낭비를 초래할 것이다.  
최적화된 필터링 순서를 아는 것이 대용량 데이터 처리의 핵심이 된다.  
<br>

>복잡한 연산이 필요한 경우,  
>SELECT 절의 별칭에 의존하기보다 인라인 뷰(Inline View)를 활용해 논리 단계를 명확히 분리하는 것이 좋겠다.  
>이를 통해 가독성을 높이고, 엔진이 어떤 순서로 데이터를 가공할지 제어하는 습관을 지향하자.  
>별칭 사용 가능 여부만 봐도 쿼리의 논리적 선후 관계를 머릿속으로 그릴 수 있게 되어야 하겠다.

<hr style="height: 5px; background-color: #777; border: none;">

## [SUMMARY]
1. 실행 순서: FROM → WHERE → GROUP BY → HAVING → SELECT → ORDER BY
2. 별칭의 한계: SELECT보다 먼저 실행되는 절(WHERE, GROUP BY, HAVING)에서는 별칭을 쓸 수 없다.
3. 예외의 구간: 오직 ORDER BY 절만이 SELECT에서 만든 별칭을 완벽하게 이해한다.
