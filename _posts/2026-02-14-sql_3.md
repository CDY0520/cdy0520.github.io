---
title: "함수의 암시적인 데이터 유형 변환 고려하기"
date: 2026-02-14 01:03:00 +0900
categories: [Tech, SQL]
tags: [SQL]
---

## 눈에 보이는 숫자가 다가 아니다: DECODE VS CASE의 비밀

![암시적 형변환](/assets/img/sql_3-1.PNG)

먼저 함수를 사용하지 않고 직업이 PRESIDENT 아닌 사원들 중에 최고 급여를 검색해보면, 3000으로 조회된다.
<br>
<br>

![암시적 형변환](/assets/img/sql_3-2.PNG)

그런데 DECODE 함수를 사용해서 찾아보니, 950으로 결과가 조회된다.  
자세히 살펴보면 아까 위에서 3000은 셀의 오른쪽에 데이터가 붙어있었고, 여기서는 셀의 왼쪽에 데이터가 붙어있는 것을 확인할 수 있다.  
<br>
정리하자면,  
숫자 데이터 유형: 셀의 오른쪽 정렬  
문자 데이터 유형: 셀의 왼쪽 정렬
<br>
<br>

![암시적 형변환](/assets/img/sql_3-3.PNG)

이것은 DECODE 함수의 암시적 형변환 매커니즘 때문에 발생하는 문제이다.  
DECODE(job, 'PRESIDENT', NULL, sal)에서 첫 번째 리턴값인 NULL의 타입을 기본적으로 문자(VARCHAR2)로 간주할 때가 많다.  
<br>
결국 숫자여야 할 sal들이 모두 문자로 변환되어 비교되는 대참사가 일어나는 것이다.  
문자열 비교에서는 '9'가 '3'보다 크기 때문에 '950'이 '3000'보다 큰 값으로 판정되어 결과가 조회된 것이다.
<br>
그래서 위의 사진처럼 숫자 변환 함수를 활용해주면 비로소 원하는 결과가 조회된다.
<br>
<br>

![암시적 형변환](/assets/img/sql_3-4.PNG)

반면에 같은 결과를 조회하기 위해 CASE 구문을 활용해보면 문제없이 원하는 결과가 조회되는 것을 볼 수 있다.

<hr style="height: 5px; background-color: #777; border: none;">

## 함수(Function) vs 문장(Statement)

### 1) DECODE = 함수
함수는 리턴값의 데이터 타입을 하나로 결정해야 한다.  
DECODE는 보통 첫 번째 리턴되는 인자의 타입을 따라가려는 성질이 있어, 의도치 않은 형변환을 유발하는 것이다.
<br>

### 2) CASE = 문장
CASE는 SQL 표준 문장(Statement)으로, DECODE보다 타입 판정에 유연하며 암시적 형변환으로 인한 성능 저하나 데이터 왜곡이 적다.  
때문에 위에서도 CASE는 별도 처리 없이도 원하는 결과값인 3000을 정확히 찾아낸다.

<hr style="height: 5px; background-color: #777; border: none;">

## 한 걸음 더: 편리함이 만든 데이터의 배신
처음에 SQL을 공부하면서 무조건 코드 짧게 작성되는 방법을 선호했었다. 정말 아무것도 몰랐다.  
그래서 정말 아무 생각없이 DECODE가 코드가 짧아서 선호했다.  
하지만 이번 케이스처럼 문자열 정렬 규칙에 따라 최대값이 바뀌는 현상을 보며 얼마나 바보같은 생각이였는지 깨달았다.  
<br> 
돌아가는 쿼리보다 안전한 쿼리를 짜는 것이 진정한 실력이 될 것이다.  
<br>
>숫자는 오른쪽, 문자는 왼쪽 정렬이다. 쿼리 결과창에서 정렬 위치만 봐도 "아, 지금 타입이 꼬였구나"를 직감할 수 있어야하겠다.  
>가급적 SQL 표준인 CASE문을 사용하거나, DECODE를 쓸 때는 TO_NUMBER처럼 데이터의 타입을 명확히 명시해주는 습관이 필요하다.  

<hr style="height: 5px; background-color: #777; border: none;">

## [SUMMARY]
1. DECODE의 함정: 첫 번째 리턴 인자의 타입을 강제하므로, 숫자 데이터가 문자로 변환되어 비교될 위험이 있다.
2. 문자열 비교의 무서움: 문자열 기준으로는 '950' > '3000' 이다. 집계 함수(MAX, MIN) 사용 시 특히 주의하자.
3. CASE문 권장: 가독성과 타입 안정성, 표준 준수 측면에서 DECODE보다 CASE문을 사용하는 것이 더 건강한 코드를 만든다.

